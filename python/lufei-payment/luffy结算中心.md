#路飞支付结算中心简单介绍：

## 结算中心	

### 添加购物车信息到redis

1	获取用户要结算课程ID	
	
    1.1	检测用户要结算的课程是否已经加入购物车	
    	
    1.2 如果不存在提示需要先加入购物车，才能结算
    	
    1.3	获取标题、图片、默认优惠卷ID、价格策略ID、优惠卷字典这个先设置为空，后面处理	
    	
    1.4	将以上信息存入到字典中，以传入的课程ID为键---值为上面收集的信息
    		
2	获取优惠卷
		
    2.1	查询出在当前时间段时符合条件的优惠卷记录
		
    2.2	遍历优惠卷，先处理没有绑定课程的优惠卷，
		
    2.3	获得优惠卷类型：满减，立减，折扣	
		根据优惠卷类型进行判断	
			如果优惠卷类型为立减，取等值货币字段
			如果类型是满减，取等值货币字段，最低消费字段
			如果类型是折扣，取折扣百分比字段
			找到满足条件的优惠卷放入到临时字典
    2.4	处理绑定课程的优惠卷:		
    2.5	优惠卷绑定的课程ID		
    2.6	优惠卷ID		
    2.7	获得优惠卷类型：满减，立减，折扣		
    2.8	根据优惠卷类型进行判断		
		如果优惠卷类型为立减，取等值货币字段	
		如果类型是满减，取等值货币字段，最低消费字段	
		如果类型是折扣，取折扣百分比字段	
    2.9	将优惠卷课程ID与用户传入的课程ID进行对比		
		如果不在字典，说明此优惠卷不可使用	
    2.10	将可以使用的优惠卷设置到指定的课程字典中	
    	
3	将绑定优惠券课程+全站优惠券 写入到redis（结算中心）	
	
    3.1	将绑定课程的优惠卷放入到redis		
    3.2	将全站优惠券写入到redis		
			
			
### 修改优惠信息
			
    1	用户提交要修改的优惠券		
    2	修改全站优惠券，课程ID无，优惠券ID为0		
		不使用优惠券情况，将全站优惠券默认ID修改为0	
    3	课程ID无，优惠券不为0		
		获取全局支付优惠券的字典	
		判断用户选择的优惠券是否合法	
		优惠券不存在，提示优惠券不合法	
		如果存在，修改全局优惠券字典的默认值	
    4	修改课程优惠券		
		优惠券ID不存在，修改默认课程优惠券ID为0	
		优惠券不为空，使用优惠当ID与用户优惠券字典对比	
			不存在提示不存在
			存在修改默认的课程ID，默认值
			
### 展示所有优惠券信息			
	获得用户ID及课程ID取得redis中的绑定课程优惠券和全局优惠券进行遍历		
			
