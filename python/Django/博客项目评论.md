# 评论列表与评论树

## 功能介绍：

主要有两部分：显示评论和评论提交评论

其中显示评论有两种实现`render`显示与`Ajax`实现,提交也一样

### 评论楼

#### 1.评论楼`render`数据

浏览器`render`显示取出文章对应的评论,浏览器渲染

#### 2.对楼层的回复标签进行操作

    a.在·回复标签·中动态绑定`楼层用户`,`楼层用户ID值`
  
    b.为回复按钮绑定事件,首先获得`评论文本框`的焦点,
  
    c.在文本框中将`@楼层用户`添加到文本框中,
  
    d.将楼层用户ID值赋给全局变量`parent_id`
  
#### 3.`提交`按钮绑定事件

成功添加信息后对`提交`按钮绑定事件,使用Ajax向服务器传值,需要传递的值有楼层`parent_id`-楼层ID，`content`-评论内容,`article_id`-文章ID

* 判断`content`是否为空
  
+ 判断`parent_id`是否为空,如果为空直接传`content`,不为空先将`@用户名`过滤后再进行传值
  
- 通过Ajaxu将数据传到服务器，先对`parent_id`进行判断，如果不为空在评论表中添加一条数据，同时更新文章表数据；`parent_id`为空同样添加，但此时这条评论为`根评论`

- 添加数据完成后，返回序列化字典(JsonResponse)，`ret = {'state':False}`其中state是表示添加数据是否发生异常
    
- 在`Ajax`中处理服务器传回的数据，`state`为真添`成功`,成功后的操作可以刷新页面(`render`)或者评论楼下动态添加一条记录(`Ajax`)
    
+ `render`实现很容易不在复述；`Ajax`实现需要的楼层可以根据需要定制，如果需要访问时间(成功添加数据完成后返回值为`添加数据对像`，取出时间放入字典)，楼层数(在渡浏览器获得即可)，回复用户(当前登录用户)，内容(服务器返回数据)等，需要注意的是如果传回的数据类型是JSON时需要进行转换(d.条中的字典可以按需要添加)
    
+ `Ajax`实现评论楼时数据构建时需要拼接字符串,可以使用`ECMAScript 6.0`（以下简称 `ES6`）实现,然后清空评论文本框内容，清空全局变量`parent_id`

### 评论树

1. 加载相关文章数,据使用`Ajax`
2. 使用`JS`对文章数据进行处理,对`父ID`进行判断，如果有`父ID`将数据添加到对应的标签下，没有`父ID`作为根评论显示到页面上 

### 添加新评论会有几个BUG:

1.点击回复提交后,不刷新页面再次提交一条评论

    第一条BUG的解决方案为提交评论后清空`pid`

2.点击回复手动删除@对象再手写入新的评论人

    第二条的这个需要匹配回复这篇文章的评论的用户,是否在回复表中
    
## 涉及知识点   

Ajax的知识运用的很多,`$.each()`,`.indexOf("")`,`slice()`,`append()`,`.attr()`,`function()()`,`ECMAScript 6.0`


`ECMAScript 6.0`的简单使用

![img1](img1 "")

![img2](img2 "")

## 示例代码


    
